@page "/"

@using System.Net
@using MassaK.Plugin
@using MassaK.Plugin.Abstractions.Enums
@using MassaK.Plugin.Impl

@implements IDisposable

<div class="w-full flex gap-2 pt-2 items-center justify-center">
  <Button OnClick="@Connect">
    Connect
  </Button>
  <Button OnClick="@Disconnect">
    Disconnect
  </Button>
</div>
<div class="w-full pt-4 flex flex-col items-center justify-center">
  <p class="text-2xl">StatusByEvent = @Status</p>
</div>



@code {
  IMassaK MassaK { get; set; } = new MassaK("COM6");
  MassaKStatus Status { get; set; } = MassaKStatus.IsDisabled;

  protected override void OnAfterRender(bool firstRender)
  {
    if (firstRender) MassaK.StatusChanged += Receive;
    base.OnAfterRender(firstRender); 
  }

  private void Connect()
  {
      MassaK.Connect();
  }
  
  private void Disconnect()
  { 
    MassaK.Disconnect();
  }

  private void Receive(object? sender, MassaKStatus status)
  {
      Status = status;
      InvokeAsync(StateHasChanged);
  }

  public void Dispose()
  {
    MassaK.Dispose();
  }
}